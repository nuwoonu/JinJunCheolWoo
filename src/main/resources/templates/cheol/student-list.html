<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  layout:decorate="~{layouts/layout}"
>
  <head>
    <title>학생 정보 관리</title>
  </head>

  <div layout:fragment="content">
    <!-- 브레드크럼 -->
    <div class="breadcrumb d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
      <div>
        <h1 class="fw-semibold mb-4 h6 text-primary-light">학생 정보 관리</h1>
        <div>
          <a th:href="@{/dashboard}" class="text-secondary-light hover-text-primary hover-underline">홈</a>
          <span class="text-secondary-light"> / 학생 정보 관리</span>
        </div>
      </div>
      <div sec:authorize="hasRole('ADMIN')">
        <a th:href="@{/student/add}" class="btn btn-primary-600 d-flex align-items-center gap-6">
          <i class="ri-add-line"></i> 학생 추가
        </a>
      </div>
    </div>

    <!-- 성공/에러 메시지 -->
    <div th:if="${successMessage}" class="alert alert-success mb-3" role="alert" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger mb-3" role="alert" th:text="${errorMessage}"></div>

    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table bordered-table mb-0" id="dataTable">
            <thead>
              <tr>
                <th scope="col">UID</th>
                <th scope="col">학번</th>
                <th scope="col">이름</th>
                <th scope="col">이메일</th>
                <th scope="col">학년-반</th>
                <th scope="col">연락처</th>
                <th scope="col">상태</th>
                <th scope="col" sec:authorize="hasRole('ADMIN')">관리</th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${#lists.isEmpty(students)}">
                <td colspan="8" class="text-center text-secondary-light py-4">
                  <i class="ri-folder-open-line d-block mb-2 text-xxl"></i>
                  등록된 학생이 없습니다.
                </td>
              </tr>
              <tr th:each="s : ${students}">
                <td th:text="${s.uid}">1</td>
                <td>
                  <span class="text-primary-600 fw-medium" th:text="${s.studentCode}">20241001</span>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <img src="/images/thumbs/avatar-img1.png" alt="프로필" class="w-40-px h-40-px rounded-circle flex-shrink-0 me-12" />
                    <h6 class="text-md mb-0 fw-medium" th:text="${s.userName ?: '-'}">학생이름</h6>
                  </div>
                </td>
                <td th:text="${s.userEmail ?: '-'}">student@school.com</td>
                <td th:text="${s.fullStudentNumber ?: (s.year + '-' + s.classNum)}">1-3-05</td>
                <td th:text="${s.phone ?: '-'}">010-1234-5678</td>
                <td>
                  <span th:classappend="${s.status?.name() == 'ENROLLED' ? 'bg-success-100 text-success-600' : 'bg-neutral-200 text-neutral-600'}"
                        class="px-12 py-4 radius-4 fw-medium text-sm"
                        th:text="${s.status?.description ?: '-'}">재학</span>
                </td>
                <td sec:authorize="hasRole('ADMIN')">
                  <div class="d-flex gap-2">
                    <a th:href="@{/student/details/{uid}(uid=${s.uid})}"
                       class="btn btn-sm btn-outline-info">
                      <i class="ri-eye-line"></i>
                    </a>
                    <a th:href="@{/student/edit/{uid}(uid=${s.uid})}"
                       class="btn btn-sm btn-outline-primary">
                      <i class="ri-edit-2-line"></i>
                    </a>
                    <form th:action="@{/student/delete/{uid}(uid=${s.uid})}" method="post"
                          onsubmit="return confirm('정말 삭제하시겠습니까?');">
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="ri-delete-bin-line"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</html>
