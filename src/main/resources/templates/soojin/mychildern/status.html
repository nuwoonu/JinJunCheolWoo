<!-- 수정안된페이지 - 아이콘, 이미지 참고용 -->
<!doctype html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  layout:decorate="~{layouts/layout}"
>
  <head>
    <title>자녀 현황</title>
  </head>

  <div layout:fragment="content">
    <div class="breadcrumb d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
      <div>
        <h1 class="fw-semibold mb-4 h6 text-primary-light">자녀 현황</h1>
        <div>
          <a th:href="@{/dashboard}" class="text-secondary-light hover-text-primary hover-underline">Dashboard</a>
          <span class="text-secondary-light"> / 자녀 현황</span>
        </div>
      </div>
    </div>

    <div th:if="${children == null or children.empty}" class="card">
      <div class="card-body text-center py-5">
        <i class="ri-user-search-line text-5xl text-secondary-light mb-3"></i>
        <h5 class="text-secondary-light">등록된 자녀가 없습니다.</h5>
        <p class="text-secondary-light">관리자에게 자녀 등록을 요청해주세요.</p>
      </div>
    </div>

    <div th:if="${children != null and !children.empty}" class="row gy-4">
      <div th:each="child : ${children}" class="col-12">
        <div class="card border-0 shadow-sm p-24" style="border-radius: 16px">
          <div class="d-flex align-items-center gap-24 mb-32 pb-24 border-bottom">
            <div class="position-relative">
              <figure
                class="w-100-px h-100-px rounded-circle overflow-hidden mb-0 border border-width-4-px border-primary-100 shadow-sm"
              >
                <img
                  th:src="${child.profileImageUrl}"
                  alt="Student"
                  class="w-100 h-100 object-fit-cover"
                  th:id="'preview-' + ${child.id}"
                />
              </figure>
              <input
                type="file"
                class="d-none"
                th:id="'file-' + ${child.id}"
                accept="image/*"
                th:onchange="'uploadPhoto(' + ${child.id} + ', this)'"
              />
              <button
                type="button"
                class="btn btn-primary position-absolute bottom-0 end-0 rounded-circle w-32-px h-32-px p-0 d-flex align-items-center justify-content-center shadow"
                th:onclick="'document.getElementById(\'file-' + ${child.id} + '\').click()'"
              >
                <i class="ri-camera-line text-xs"></i>
              </button>
            </div>
            <div>
              <h3 class="fw-bold mb-8" th:text="${child.name}">이름</h3>
              <div class="d-flex gap-8 mb-8">
                <span class="badge bg-neutral-100 text-secondary-light px-12 py-6 fw-medium">
                  <i class="ri-hashtag me-1"></i>학번: <span th:text="${child.studentNumber}"></span>
                </span>
                <span class="badge bg-neutral-100 text-secondary-light px-12 py-6 fw-medium">
                  <i class="ri-book-open-line me-1"></i><span th:text="${child.grade}"></span>학년
                  <span th:text="${child.classNum}"></span>반
                </span>
              </div>
              <div th:id="'status-' + ${child.id}" class="text-sm"></div>
            </div>
          </div>

          <div class="row gy-4 mb-32">
            <div class="col-xl-4 col-md-6">
              <div class="card h-100 border border-neutral-100 p-20 shadow-none" style="border-radius: 12px">
                <h6 class="fw-bold mb-20"><i class="ri-calendar-check-line text-primary-600 me-2"></i>출결 현황</h6>
                <div class="d-flex justify-content-around align-items-center py-8">
                  <div class="text-center">
                    <div
                      class="w-48-px h-48-px bg-success-600 rounded-circle d-flex align-items-center justify-content-center mb-12 mx-auto shadow-sm"
                    >
                      <span class="text-white fw-bold">20</span>
                    </div>
                    <span class="text-sm fw-medium">출석</span>
                  </div>
                  <div class="text-center">
                    <div
                      class="w-48-px h-48-px bg-warning-400 rounded-circle d-flex align-items-center justify-content-center mb-12 mx-auto shadow-sm"
                    >
                      <span class="text-white fw-bold">1</span>
                    </div>
                    <span class="text-sm fw-medium">지각</span>
                  </div>
                  <div class="text-center">
                    <div
                      class="w-48-px h-48-px bg-danger-500 rounded-circle d-flex align-items-center justify-content-center mb-12 mx-auto shadow-sm"
                    >
                      <span class="text-white fw-bold">0</span>
                    </div>
                    <span class="text-sm fw-medium">결석</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xl-4 col-md-6">
              <div
                class="card h-100 border border-neutral-100 shadow-none"
                style="border-radius: 12px; overflow: hidden"
              >
                <div class="p-20 pb-0">
                  <h6 class="fw-bold mb-16"><i class="ri-time-line text-primary-600 me-2"></i>오늘의 시간표</h6>
                </div>
                <table class="table table-sm mb-0">
                  <tbody>
                    <tr class="align-middle">
                      <td class="bg-warning-50 text-center fw-medium py-12 w-80-px">1교시</td>
                      <td class="ps-20">국어</td>
                    </tr>
                    <tr class="align-middle border-top">
                      <td class="bg-neutral-50 text-center fw-medium py-12">2교시</td>
                      <td class="ps-20">영어</td>
                    </tr>
                    <tr class="align-middle border-top">
                      <td class="bg-neutral-50 text-center fw-medium py-12">3교시</td>
                      <td class="ps-20">수학</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="col-xl-4 col-md-12">
              <div class="card h-100 border border-neutral-100 p-20 shadow-none" style="border-radius: 12px">
                <h6 class="fw-bold mb-16"><i class="ri-restaurant-line text-primary-600 me-2"></i>오늘의 급식</h6>
                <p class="text-secondary-light lh-lg mb-16">
                  잡곡밥, 쇠고기미역국, 제육볶음, 콩나물무침, 배추김치, 우유
                </p>
                <div>
                  <span class="badge bg-primary-600 px-12 py-8 rounded-pill shadow-sm">칼로리: 645kcal</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card border border-neutral-100 p-20 shadow-none" style="border-radius: 12px">
            <div class="d-flex justify-content-between align-items-center mb-20">
              <h6 class="fw-bold mb-0"><i class="ri-mail-line text-primary-600 me-2"></i>최신 가정통신문</h6>
              <a href="#" class="btn btn-outline-neutral-200 btn-sm text-xs px-12">더보기</a>
            </div>
            <div class="d-flex flex-column gap-16">
              <div
                class="d-flex align-items-center justify-content-between p-12 bg-neutral-50 rounded-8 hover-bg-neutral-100 transition-all"
              >
                <div class="d-flex align-items-center gap-12">
                  <i class="ri-checkbox-circle-fill text-success-600 fs-5"></i>
                  <span class="fw-medium text-sm">[안내] 2학기 현장학습 신청 안내</span>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <span class="badge bg-primary-100 text-primary-600 px-12 py-4 rounded-pill text-xs">1월 25일</span>
                  <span class="text-xs text-secondary-light">2026-01-20</span>
                </div>
              </div>
              <div
                class="d-flex align-items-center justify-content-between p-12 bg-neutral-50 rounded-8 hover-bg-neutral-100 transition-all"
              >
                <div class="d-flex align-items-center gap-12">
                  <i class="ri-checkbox-circle-fill text-success-600 fs-5"></i>
                  <span class="fw-medium text-sm">[공지] 독감 예방 접종 권고</span>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <span class="badge bg-info-100 text-info-600 px-12 py-4 rounded-pill text-xs">2월 05일</span>
                  <span class="text-xs text-secondary-light">2026-01-18</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <th:block layout:fragment="script">
    <script th:inline="javascript">
      function uploadPhoto(childId, input) {
        const file = input.files[0];
        if (!file) return;

        // 이미지 미리보기
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("preview-" + childId).src = e.target.result;
        };
        reader.readAsDataURL(file);

        // 업로드
        const statusEl = document.getElementById("status-" + childId);
        statusEl.innerHTML = '<span class="text-warning"><i class="ri-loader-4-line"></i> 업로드 중...</span>';

        const formData = new FormData();
        formData.append("studentId", childId);
        formData.append("file", file);

        fetch("/profile/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (response.ok) {
              return response.text();
            }
            throw new Error("업로드 실패");
          })
          .then((imageUrl) => {
            statusEl.innerHTML =
              '<span class="text-success"><i class="ri-check-line"></i> 사진이 변경되었습니다.</span>';
            document.getElementById("preview-" + childId).src = imageUrl;
            setTimeout(() => {
              statusEl.innerHTML = "";
            }, 3000);
          })
          .catch((error) => {
            statusEl.innerHTML = '<span class="text-danger"><i class="ri-close-line"></i> 업로드 실패</span>';
            console.error("Upload error:", error);
          });
      }
    </script>
  </th:block>
</html>
