<!doctype html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/layout}"
>
  <head>
    <title>자녀 현황</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />
  </head>

  <div layout:fragment="content">
    <div class="d-flex flex-wrap gap-12 mb-24" th:if="${children != null and children.size() > 1}">
      <a
        th:each="c : ${children}"
        th:href="@{'/parent/children/status/' + ${c.id}}"
        th:text="${c.name}"
        class="btn px-24 py-10 rounded-pill fw-bold shadow-sm"
        th:classappend="${#vars.childId != null and #vars.childId == c.id} ? 'btn-primary' : 'btn-white text-secondary-light border-neutral-200'"
      >
      </a>
    </div>

    <div th:if="${children == null or children.empty}" class="card border-0 shadow-sm p-80 text-center">
      <i class="ri-user-search-line text-5xl text-neutral-300 mb-16"></i>
      <h5 class="text-secondary-light">등록된 자녀가 없습니다.</h5>
    </div>

    <div th:if="${children != null and !children.empty}" th:with="child=${children[0]}">
      <!-- 상단 3개 카드 -->
      <div class="row gy-4 mb-24">
        <!-- 학생 프로필 카드 -->
        <div class="col-xl-4 col-md-5">
          <div class="card border-0 shadow-sm p-24 h-100 text-center" style="border-radius: 16px">
            <div
              class="w-120-px h-120-px rounded-circle bg-neutral-200 mx-auto mb-16 d-flex align-items-center justify-content-center text-secondary-light"
            >
              <span class="text-sm">120X120</span>
            </div>
            <h4 class="fw-bold mb-4" th:text="${child.name}">김학생</h4>
            <p class="text-secondary-light text-sm mb-12">
              <span th:text="${child.grade}">1</span>학년 <span th:text="${child.classNum}">2</span>반
              <span th:text="${child.studentNumber}">3</span>번
            </p>
            <span th:id="'badge-' + ${child.id}" class="badge bg-success-600 px-16 py-6 rounded-pill fs-13 mx-auto mb-24">
              출석
            </span>

            <div class="border-top pt-20">
              <h6 class="fw-bold mb-20 text-sm text-start">
                <i class="ri-checkbox-circle-line text-success-600 me-2"></i>출결 현황
              </h6>
              <div class="d-flex justify-content-around text-center">
                <div>
                  <div
                    class="w-56-px h-56-px rounded-circle bg-success-600 d-flex align-items-center justify-content-center mx-auto mb-8"
                  >
                    <span class="text-white fw-bold fs-18">20</span>
                  </div>
                  <span class="text-xs text-secondary-light">출석</span>
                </div>
                <div>
                  <div
                    class="w-56-px h-56-px rounded-circle bg-warning-main d-flex align-items-center justify-content-center mx-auto mb-8"
                  >
                    <span class="text-white fw-bold fs-18">1</span>
                  </div>
                  <span class="text-xs text-secondary-light">지각</span>
                </div>
                <div>
                  <div
                    class="w-56-px h-56-px rounded-circle bg-danger-main d-flex align-items-center justify-content-center mx-auto mb-8"
                  >
                    <span class="text-white fw-bold fs-18">0</span>
                  </div>
                  <span class="text-xs text-secondary-light">결석</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 오늘의 시간표 -->
        <div class="col-xl-4 col-md-7">
          <div class="card border-0 shadow-sm h-100 overflow-hidden" style="border-radius: 16px">
            <div class="p-16 border-bottom">
              <h6 class="fw-bold mb-0 text-sm">
                <i class="ri-time-line text-primary-600 me-2"></i>오늘의 시간표 (7교시)
              </h6>
            </div>
            <div class="p-16">
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">1교시</span>
                  <span class="text-secondary-light ms-8">09:00-09:45</span>
                </span>
                <span class="fw-medium text-dark text-sm">국어</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">2교시</span>
                  <span class="text-secondary-light ms-8">09:55-10:40</span>
                </span>
                <span class="fw-medium text-dark text-sm">수학</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">3교시</span>
                  <span class="text-secondary-light ms-8">10:50-11:35</span>
                </span>
                <span class="fw-medium text-dark text-sm">영어</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">4교시</span>
                  <span class="text-secondary-light ms-8">11:45-12:30</span>
                </span>
                <span class="fw-medium text-dark text-sm">과학</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">5교시</span>
                  <span class="text-secondary-light ms-8">13:30-14:15</span>
                </span>
                <span class="fw-medium text-dark text-sm">사회</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center mb-8">
                <span class="text-sm">
                  <span class="fw-bold">6교시</span>
                  <span class="text-secondary-light ms-8">14:25-15:10</span>
                </span>
                <span class="fw-medium text-dark text-sm">체육</span>
              </div>
              <div class="p-10 bg-neutral-50 rounded-8 d-flex justify-content-between align-items-center">
                <span class="text-sm">
                  <span class="fw-bold">7교시</span>
                  <span class="text-secondary-light ms-8">15:20-16:05</span>
                </span>
                <span class="fw-medium text-dark text-sm">자율</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 학교 일정 -->
        <div class="col-xl-4 col-md-12">
          <div class="card border-0 shadow-sm h-100 p-20" style="border-radius: 16px">
            <h6 class="fw-bold mb-20 text-sm">
              <i class="ri-calendar-event-line text-primary-600 me-2"></i>학교 일정
            </h6>
            <div class="d-flex align-items-center justify-content-between mb-16">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-calendar-line text-secondary-light"></i>
                <span class="text-sm">1/23(금) 겨울방학식</span>
              </div>
              <span class="badge bg-danger-main text-white px-12 py-4 rounded-pill">D-2</span>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-calendar-line text-secondary-light"></i>
                <span class="text-sm">2/10(수) 개학식</span>
              </div>
              <span class="badge bg-danger-main text-white px-12 py-4 rounded-pill">D-14</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 중단: 가정통신문 + 오늘의 급식 -->
      <div class="row gy-4 mb-24">
        <!-- 가정통신문 -->
        <div class="col-xl-8">
          <div class="card border-0 shadow-sm p-20" style="border-radius: 16px">
            <h6 class="fw-bold mb-20 text-sm">
              <i class="ri-file-list-3-line text-primary-600 me-2"></i>가정통신문
            </h6>
            <div class="d-flex align-items-center justify-content-between py-12 border-bottom">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-file-text-line text-secondary-light"></i>
                <span class="text-sm">[안내] 체험학습 신청서 안내</span>
              </div>
              <div class="d-flex align-items-center gap-12">
                <span class="badge bg-success-100 text-success-600 px-12 py-4 rounded-pill text-xs">1일 전</span>
                <span class="text-xs text-secondary-light">2026-01-20</span>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between py-12 border-bottom">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-file-text-line text-secondary-light"></i>
                <span class="text-sm">[공지] 독감 예방 접종 안내</span>
              </div>
              <div class="d-flex align-items-center gap-12">
                <span class="badge bg-success-100 text-success-600 px-12 py-4 rounded-pill text-xs">2일 전</span>
                <span class="text-xs text-secondary-light">2026-01-18</span>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between py-12">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-file-text-line text-secondary-light"></i>
                <span class="text-sm">[안내] 학부모 상담 주간 안내</span>
              </div>
              <div class="d-flex align-items-center gap-12">
                <span class="badge bg-success-100 text-success-600 px-12 py-4 rounded-pill text-xs">3일 전</span>
                <span class="text-xs text-secondary-light">2026-01-17</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 오늘의 급식 -->
        <div class="col-xl-4">
          <div class="card border-0 shadow-sm p-20 h-100" style="border-radius: 16px">
            <h6 class="fw-bold mb-20 text-sm">
              <i class="ri-restaurant-2-line text-primary-600 me-2"></i>오늘의 급식
            </h6>
            <p class="text-sm mb-12">잡곡밥, 미역국, 제육볶음, 배추김치, 과일</p>
            <span class="badge bg-primary-100 text-primary-600 px-8 py-4 rounded-pill text-xs">칼로리: 645kcal</span>
          </div>
        </div>
      </div>

      <!-- 하단: 학급 알림장 -->
      <div class="row">
        <div class="col-12">
          <div class="card border-0 shadow-sm p-20" style="border-radius: 16px">
            <h6 class="fw-bold mb-20 text-sm">
              <i class="ri-notification-3-line text-warning-main me-2"></i>학급 알림장
            </h6>
            <div class="d-flex align-items-center justify-content-between py-12 border-bottom">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-notification-line text-secondary-light"></i>
                <span class="text-sm">내일 수학 퀴즈 있습니다</span>
              </div>
              <span class="text-xs text-secondary-light">2026-01-26</span>
            </div>
            <div class="d-flex align-items-center justify-content-between py-12 border-bottom">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-notification-line text-secondary-light"></i>
                <span class="text-sm">체육복 준비해오세요</span>
              </div>
              <span class="text-xs text-secondary-light">2026-01-25</span>
            </div>
            <div class="d-flex align-items-center justify-content-between py-12">
              <div class="d-flex align-items-center gap-12">
                <i class="ri-notification-line text-secondary-light"></i>
                <span class="text-sm">과학 실험 준비물 확인</span>
              </div>
              <span class="text-xs text-secondary-light">2026-01-24</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <th:block layout:fragment="script">
    <script th:inline="javascript">
      function refreshStatus(childId) {
        const badge = document.getElementById("badge-" + childId);
        badge.innerHTML = '<i class="ri-loader-4-line ri-spin"></i> 확인 중';
        fetch("/api/parent/child-status/" + childId)
          .then((res) => res.json())
          .then((data) => {
            badge.innerText = data.status || "출석(입실)";
          })
          .catch(() => {
            badge.innerText = "출석(입실)";
          });
      }
    </script>
  </th:block>
</html>
