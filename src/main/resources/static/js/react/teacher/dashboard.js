import{r as a,j as e,c as O}from"../shared/client-Cmjl_fXq.js";const Y=[{value:"MONDAY",label:"ÏõîÏöîÏùº"},{value:"TUESDAY",label:"ÌôîÏöîÏùº"},{value:"WEDNESDAY",label:"ÏàòÏöîÏùº"},{value:"THURSDAY",label:"Î™©ÏöîÏùº"},{value:"FRIDAY",label:"Í∏àÏöîÏùº"}],k=["#3b82f6","#8b5cf6","#f59e0b","#10b981","#0ea5e9"],f=n=>n.substring(0,5);function A(){return{1:"MONDAY",2:"TUESDAY",3:"WEDNESDAY",4:"THURSDAY",5:"FRIDAY"}[new Date().getDay()]??"MONDAY"}function D(){return{dayOfWeek:A(),period:1,startTime:"09:00",endTime:"09:45",subjectName:"",className:"",location:"",repeatType:"WEEKLY",specificDate:"",memo:""}}function L(){const[n,d]=a.useState("Ïò§ÎäòÏùò ÏàòÏóÖ ÏùºÏ†ï"),[c,r]=a.useState([]),[m,p]=a.useState(!0),[i,v]=a.useState(null),[E,b]=a.useState(!1),[u,g]=a.useState(null),[o,j]=a.useState(D()),[C,S]=a.useState(!1),x=a.useCallback(async()=>{try{p(!0);const l=await fetch("/api/teacher/schedule/today",{credentials:"include"});if(!l.ok)throw new Error(`ÏÑúÎ≤Ñ Ïò§Î•ò: ${l.status}`);const s=await l.json();d(s.label),r(s.schedules),v(null)}catch(l){v(l instanceof Error?l.message:"ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.")}finally{p(!1)}},[]);a.useEffect(()=>{x()},[x]);const w=()=>{j(D()),g(null),b(!0)},N=l=>{j({dayOfWeek:l.dayOfWeek,period:l.period,startTime:f(l.startTime),endTime:f(l.endTime),subjectName:l.subjectName,className:l.className??"",location:l.location??"",repeatType:l.repeatType,specificDate:l.specificDate??"",memo:l.memo??""}),g(l),b(!0)},T=()=>{b(!1),g(null)},z=(l,s)=>j(h=>({...h,[l]:s})),R=async()=>{if(!o.subjectName.trim()){alert("Í≥ºÎ™©Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if(!o.startTime){alert("ÏãúÏûë ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}if(!o.endTime){alert("Ï¢ÖÎ£å ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");return}S(!0);try{const l={...o,className:o.className||null,location:o.location||null,specificDate:o.specificDate||null,memo:o.memo||null},s=u?`/api/teacher/schedule/${u.id}`:"/api/teacher/schedule",y=await fetch(s,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)});if(!y.ok){const W=await y.text();throw new Error(W||"Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}T(),await x()}catch(l){alert(l instanceof Error?l.message:"Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.")}finally{S(!1)}},I=async l=>{if(confirm("Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?"))try{if(!(await fetch(`/api/teacher/schedule/${l}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("ÏÇ≠Ï†ú Ïã§Ìå®");r(h=>h.filter(y=>y.id!==l))}catch(s){alert(s instanceof Error?s.message:"ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:t.card,children:[e.jsxs("div",{style:t.cardHeader,children:[e.jsxs("h6",{style:t.cardTitle,children:[e.jsx("span",{style:{marginRight:6},children:"üìÖ"}),n]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{onClick:w,style:t.addBtn,children:"+ ÏùºÏ†ï Ï∂îÍ∞Ä"}),e.jsx("a",{href:"/teacher/schedule",style:t.manageLink,children:"ÏùºÏ†ï Í¥ÄÎ¶¨ ‚Üí"})]})]}),e.jsx("div",{style:t.cardBody,children:m?e.jsxs("div",{style:t.center,children:[e.jsx("div",{style:t.spinner}),e.jsx("p",{style:{color:"#9ca3af",marginTop:10,fontSize:13},children:"Î∂àÎü¨Ïò§Îäî Ï§ë..."})]}):i?e.jsxs("div",{style:t.errorBox,children:["‚ö† ",i,e.jsx("button",{onClick:x,style:t.retryBtn,children:"Îã§Ïãú ÏãúÎèÑ"})]}):c.length===0?e.jsxs("div",{style:t.empty,children:[e.jsx("div",{style:{fontSize:40,marginBottom:10},children:"üì≠"}),e.jsxs("p",{style:{color:"#9ca3af",fontSize:14,marginBottom:12},children:[n,"Ïù¥ ÏóÜÏäµÎãàÎã§"]}),e.jsx("button",{onClick:w,style:t.addBtn,children:"+ ÏùºÏ†ï Îì±Î°ùÌïòÍ∏∞"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:c.map((l,s)=>e.jsx(G,{schedule:l,color:k[s%k.length],onEdit:()=>N(l),onDelete:()=>I(l.id)},l.id))})})]}),E&&e.jsx(H,{form:o,isEdit:!!u,submitting:C,onChangeField:z,onSubmit:R,onClose:T})]})}function G({schedule:n,color:d,onEdit:c,onDelete:r}){return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{style:{...t.scheduleBar,borderLeftColor:d},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsxs("span",{style:{...t.periodBadge,background:d+"22",color:d},children:[n.period,"ÍµêÏãú"]}),e.jsx("span",{style:{fontWeight:600,fontSize:14,color:"#111827"},children:n.subjectName})]}),e.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[f(n.startTime)," - ",f(n.endTime),n.className&&e.jsxs("span",{style:{marginLeft:8},children:["| ",n.className]}),n.location&&e.jsxs("span",{style:{marginLeft:6},children:["| ",n.location]})]}),n.memo&&e.jsxs("div",{style:{fontSize:11,color:"#9ca3af",marginTop:3},children:["üìù ",n.memo]})]}),e.jsxs("div",{style:{display:"flex",gap:4,flexShrink:0},children:[e.jsx("button",{onClick:c,style:t.editIconBtn,title:"ÏàòÏ†ï",children:"‚úè"}),e.jsx("button",{onClick:r,style:t.deleteIconBtn,title:"ÏÇ≠Ï†ú",children:"üóë"})]})]})}function H({form:n,isEdit:d,submitting:c,onChangeField:r,onSubmit:m,onClose:p}){return e.jsx("div",{style:t.overlay,onClick:p,children:e.jsxs("div",{style:t.modal,onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{style:t.modalHeader,children:[e.jsx("h6",{style:{margin:0,fontWeight:600},children:d?"ÏùºÏ†ï ÏàòÏ†ï":"ÏùºÏ†ï Ï∂îÍ∞Ä"}),e.jsx("button",{onClick:p,style:t.closeBtn,children:"‚úï"})]}),e.jsxs("div",{style:t.modalBody,children:[e.jsxs("div",{style:t.row2,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"ÏöîÏùº"}),e.jsx("select",{style:t.select,value:n.dayOfWeek,onChange:i=>r("dayOfWeek",i.target.value),children:Y.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"ÍµêÏãú"}),e.jsx("input",{type:"number",min:1,max:8,style:t.input,value:n.period,onChange:i=>r("period",Number(i.target.value))})]})]}),e.jsxs("div",{style:t.row2,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"ÏãúÏûë ÏãúÍ∞Ñ"}),e.jsx("input",{type:"time",style:t.input,value:n.startTime,onChange:i=>r("startTime",i.target.value)})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Ï¢ÖÎ£å ÏãúÍ∞Ñ"}),e.jsx("input",{type:"time",style:t.input,value:n.endTime,onChange:i=>r("endTime",i.target.value)})]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsxs("label",{style:t.label,children:["Í≥ºÎ™©Î™Ö ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{type:"text",placeholder:"Ïòà: ÏàòÌïô",style:t.input,value:n.subjectName,onChange:i=>r("subjectName",i.target.value)})]}),e.jsxs("div",{style:t.row2,children:[e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"ÌïôÍ∏â"}),e.jsx("input",{type:"text",placeholder:"Ïòà: 1ÌïôÎÖÑ 2Î∞ò",style:t.input,value:n.className,onChange:i=>r("className",i.target.value)})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Ïû•ÏÜå"}),e.jsx("input",{type:"text",placeholder:"Ïòà: 3-2 ÍµêÏã§",style:t.input,value:n.location,onChange:i=>r("location",i.target.value)})]})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Î∞òÎ≥µ"}),e.jsxs("select",{style:t.select,value:n.repeatType,onChange:i=>r("repeatType",i.target.value),children:[e.jsx("option",{value:"WEEKLY",children:"Îß§Ï£º"}),e.jsx("option",{value:"BIWEEKLY",children:"2Ï£ºÎßàÎã§"}),e.jsx("option",{value:"ONCE",children:"ÌäπÏ†ï ÎÇ†ÏßúÎßå"})]})]}),n.repeatType==="ONCE"&&e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"ÎÇ†Ïßú"}),e.jsx("input",{type:"date",style:t.input,value:n.specificDate,onChange:i=>r("specificDate",i.target.value)})]}),e.jsxs("div",{style:t.formGroup,children:[e.jsx("label",{style:t.label,children:"Î©îÎ™®"}),e.jsx("textarea",{rows:2,placeholder:"Í∞ÑÎã®Ìïú Î©îÎ™® (ÏÑ†ÌÉù)",style:{...t.input,resize:"vertical"},value:n.memo,onChange:i=>r("memo",i.target.value)})]})]}),e.jsxs("div",{style:t.modalFooter,children:[e.jsx("button",{onClick:p,style:t.cancelBtn,disabled:c,children:"Ï∑®ÏÜå"}),e.jsx("button",{onClick:m,style:t.saveBtn,disabled:c,children:c?"Ï†ÄÏû• Ï§ë...":d?"ÏàòÏ†ï ÏôÑÎ£å":"Îì±Î°ù"})]})]})})}const t={card:{background:"white",borderRadius:12,border:"1px solid #e5e7eb",height:"100%",display:"flex",flexDirection:"column"},cardHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid #e5e7eb",flexWrap:"wrap",gap:8},cardTitle:{margin:0,fontSize:16,fontWeight:600,color:"#111827",display:"flex",alignItems:"center"},cardBody:{padding:"20px",overflowY:"auto",maxHeight:460},addBtn:{background:"#4f46e5",color:"white",border:"none",borderRadius:6,padding:"6px 14px",fontSize:13,fontWeight:500,cursor:"pointer"},manageLink:{color:"#6b7280",fontSize:13,textDecoration:"none"},center:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 0"},spinner:{width:32,height:32,border:"3px solid #e5e7eb",borderTop:"3px solid #4f46e5",borderRadius:"50%",animation:"spin 0.8s linear infinite"},errorBox:{padding:"14px 16px",background:"#fef2f2",border:"1px solid #fca5a5",color:"#b91c1c",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14},retryBtn:{background:"#ef4444",color:"white",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontSize:13},empty:{textAlign:"center",padding:"40px 20px"},scheduleBar:{flex:1,paddingLeft:12,borderLeft:"3px solid #e5e7eb"},periodBadge:{fontSize:11,fontWeight:600,padding:"2px 8px",borderRadius:4},editIconBtn:{width:28,height:28,borderRadius:6,background:"#e0e7ff",border:"none",cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center"},deleteIconBtn:{width:28,height:28,borderRadius:6,background:"#fee2e2",border:"none",cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center"},overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},modal:{background:"white",borderRadius:12,width:"100%",maxWidth:500,maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.2)",margin:"0 16px"},modalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid #e5e7eb"},modalBody:{padding:"20px",display:"flex",flexDirection:"column",gap:14},modalFooter:{display:"flex",justifyContent:"flex-end",gap:8,padding:"14px 20px",borderTop:"1px solid #e5e7eb"},closeBtn:{background:"none",border:"none",fontSize:16,cursor:"pointer",color:"#6b7280",padding:4},row2:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},formGroup:{display:"flex",flexDirection:"column",gap:4},label:{fontSize:13,fontWeight:500,color:"#374151"},input:{border:"1px solid #d1d5db",borderRadius:6,padding:"8px 10px",fontSize:14,color:"#111827",outline:"none",width:"100%",boxSizing:"border-box"},select:{border:"1px solid #d1d5db",borderRadius:6,padding:"8px 10px",fontSize:14,color:"#111827",outline:"none",width:"100%",boxSizing:"border-box",background:"white"},cancelBtn:{background:"#f3f4f6",color:"#374151",border:"none",borderRadius:6,padding:"8px 20px",cursor:"pointer",fontSize:14},saveBtn:{background:"#4f46e5",color:"white",border:"none",borderRadius:6,padding:"8px 20px",cursor:"pointer",fontSize:14,fontWeight:500}},B=document.getElementById("dashboard-schedule-root");B&&O(B).render(e.jsx(a.StrictMode,{children:e.jsx(L,{})}));
